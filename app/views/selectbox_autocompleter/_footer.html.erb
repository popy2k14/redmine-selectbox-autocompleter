<% type = Setting.plugin_selectbox_autocompleter['autocomplete_type'] %>
<%
  if type == 'select2'
%>
<script type="text/javascript">
  (function(){
    // select autocomplete plugin init
    var isInit = false;

    console.log( <%= raw generate_exclude_target_list_for_js %>)
    console.log( <%= generate_autocompleter_min_count_show_search %>)

    function initSelectboxAutocompleter(mutationRecord) {
      <%= raw generate_target_list_for_js %>.forEach(function (target) {
        var $selectbox = $('#' + target);

        if (!$selectbox.hasClass('select2-hidden-accessible') && $selectbox.is(':visible')) {
          const isMultiple = !!$selectbox.attr('multiple');
          $selectbox
            .addClass('select-autocomplete')
            .attr('data-multiple', isMultiple)
            .select2({multiple: isMultiple, tags: isMultiple});
        }

        if (!isInit) return;

        const multipleChangeTarget = mutationRecord.find((record) => record.type === 'attributes' && record.attributeName === 'multiple');

        if (multipleChangeTarget && multipleChangeTarget.target.id === target) {
          const isMultiple = multipleChangeTarget.target.multiple;

          if (isMultiple !== $(multipleChangeTarget.target).data('multiple')) {
            $(multipleChangeTarget.target)
              .data('multiple', isMultiple)
              .select2('destroy')
              .select2({multiple: isMultiple, tags: isMultiple});
          }
        }
      });

      isInit = true;
    }

    var mo = new MutationObserver(initSelectboxAutocompleter);
    mo.observe(document.body, { attributes: true, childList: true, subtree: true });
  })();
</script>
<%
  end
%>
<%
  if type == 'datalist' || type == 'jquery'
%>
<script type="text/javascript">
  (function(){
    // select autocomplete plugin init

    function initSelectboxAutocompleter() {
      <%= raw generate_target_list_for_js %>.forEach(function(target) {selectboxAutocompleter.generateSelectboxAutocompleter(target, '<%= type %>')});
    }

    var mo = new MutationObserver(initSelectboxAutocompleter);
    mo.observe(document.body, { attributes: true, childList: true, subtree: true });
  })();
</script>
<%
  end
%>
